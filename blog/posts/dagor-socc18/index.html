<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="apple-touch-icon" sizes="180x180" href="/blog/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/blog/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/blog/favicon-16x16.png">
	<link rel="manifest" href="/blog/site.webmanifest">
	<link rel="mask-icon" href="/blog/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/blog/favicon.ico">
	<title>Overload Control for Scaling WeChat Microservices, SoCC &#39;18</title>
	<link rel="stylesheet" href="/blog/css/style.min.4fecf4c2d95f896869e64f36a14369caef0eeb1b4beab0f48c949aa99d18cc07.css" integrity="sha256-T+z0wtlfiWhp5k82oUNpyu8O6xtL6rD0jJSaqZ0YzAc=">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://millyz.github.io/blog/">The Evening Paper</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="/blog/posts/">Posts</a>
					<a href="/blog/about/">About</a>
				</nav>
			</div>
			<div class="hdr-right">
				<div class="hdr-icons">
					<span class="hide-in-mobile"><a href="https://github.com/millyz" target="_blank" rel="noopener"><span class="screen-reader-text">github</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span>
					<button id="menu-btn" class="hdr-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
				</div>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast" style="display: none;">
		<ul>
			<li><a href="/blog/posts/">Posts</a></li>
			<li><a href="/blog/about/">About</a></li>
		</ul>
	</div>

	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Dec 3, 2018</span></div>
				<h1>Overload Control for Scaling WeChat Microservices, SoCC &#39;18</h1>
			</header>
			<div class="content">
				<p>This paper presents the microservice architecture and overload control at
WeChat. We can take a look how such a massive application runs internally,
which is the point attracting me most. This paper is easy to follow and
understand. In conclusion, the technique introduced in this paper seems
straightforward and practical.</p>

<p>The motivation of this paper is quite strong and very clear. &ldquo;Workload handled
by the WeChat backend is always varying over time, and the fluctuation pattern
differs among diverse situations&rdquo;. The request amount during peak hours is
about 3 times larger than the daily average, even 10 times during the period of
Chinese Lunar New Year. Obviously, it is not economic to run physical machines
based on the maximum request amount. Therefore, overload control mechanism is
required to adaptively tolerate the workload fluctuation at system runtime.</p>

<p>This paper targets to solve <em>subsequent overload</em>, where more than one
overloaded services or the single overloaded service is invoked multiple times
by the associated upstream services. In this scenario, the inappropriate load
shedding can aggravate the overload situation. Basically, the upstream service
re-sends requests to a overloaded server and a larger fraction of requests
fails, which degrade the overall throughput. Therefore, simple load shedding
does not work here.  The authors need to tackle with the following challenges
when designing overload control algorithm for WeChat:</p>

<ul>
<li>No single entry point for service requests sent to the Wechat backend.

<ul>
<li>Centralized load monitoring at a global entry point is not valid.</li>
<li>Fail to pinpoint the slow service due to the complex call path.</li>
</ul></li>
<li>Excessive request abortion not only wastes the computational resources but
also increases the latency of service response.

<ul>
<li>Call for proper management on load shedding.</li>
</ul></li>
</ul>

<p>The proposed overload control scheme for WeChat is called DAGOR, consisting
<strong>overload detection</strong> and <strong>service admission control</strong>.</p>

<p>DAGOR takes the <em>queuing time</em> to profile the load status of a server. The
queuing time is measured by the time difference between the request arrival and
its processing being started at the server. When a server becomes overloaded
due to resource exhaustion, the queuing time rises proportional to the excess
workload. They do not use the response time because it additionally counts the
request processing time, which may be inaccurate to reflect the load status.</p>

<p>For service admission control, DAGOR mainly considers <em>business-oriented
admission control</em>, <em>user-oriented admission control</em>, <em>adaptive admission
control</em> and <em>collaborative admission control</em>:</p>

<ul>
<li>Business-oriented admission control, the request with higher business
significance and greater impact on user experience is of the higher priority.
For example, payment service has higher priority than messaging while
messaging is more important than moments. The business priorities are
predefined and stored in a hash table, which remains stable.</li>
<li>User-oriented admission control, discard the requests of some user which has
lower user priority at the same business priority. The user priority is
generated by a hash function using the user ID and changes every hour for
fairness. They also mention session-oriented admission control, which is
similar to user-oriented admission control.</li>
<li>Adaptive admission control, reject more incoming requests restrictedly and
relax the admission control for mild overload situation. DAGOR combines the
above two schemes with respect to the individual load status. Based on the
result of load detection, the server increases/decreases the expected amount of
incoming requests. Then the sever can set a proper business and user priority.</li>
<li>Collaborative admission control, the downstream server sends its admission level to the upstream server such that some requests can be rejected by the upstream server early.</li>
</ul>

<p>DAROR has been deployed in Wechat for more than five year, demonstrating its effectiveness and robustness. A practical design indeed.</p>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://millyz.github.io/blog/tags/paper-reading">Paper Reading</a></span><span class="tag"><a href="https://millyz.github.io/blog/tags/overload-control">Overload control</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>597 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2018-12-03 17:21 &#43;0800</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="next-post" href="https://millyz.github.io/blog/posts/spiffy-fast18/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>Spiffy: Enabling File-System Aware Storage Applications, FAST &#39;18</span>
			</a>
			<a class="prev-post" href="https://millyz.github.io/blog/posts/claycodes-fast18/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>Clay codes: Moulding MDS Codes to Yield an MSR Code, FAST &#39;18</span>
			</a>
		</div>
	</main>

<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>

	<script>let haveHeader = true;</script>

	<script src="/blog/js/main.min.00689ba18bbf9422fda222b02b555f01d54bfbb9b6d02f9bcffad67bdb2ff2cd.js" integrity="sha256-AGiboYu/lCL9oiKwK1VfAdVL+7m20C+bz/rWe9sv8s0="></script>
	
</body>

</html>